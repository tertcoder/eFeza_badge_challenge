import { useEffect, useState } from "react";
import html2canvas from "html2canvas";
import jsPDF from "jspdf";
import PropTypes from "prop-types";
import AgentInfo from "../ui/AgentInfo";
import logo from "../assets/efeza.png";
import imageToPreview from "../utils/func";

function Badge({ data, image, setOpen }) {
  const { nom, prenom, telephone, code } = data;
  const [imagePreview, setImagePreview] = useState(null);

  useEffect(() => {
    async function getImagePreview() {
      if (!image) return;
      const imageData = await imageToPreview(image);
      console.log(imageData);
      setImagePreview(imageData);
    }
    getImagePreview();
  }, [image]);

  async function handleImageDownload() {
    const badgeElement = document.getElementById("badge");
    const canvas = await html2canvas(badgeElement);
    const data = canvas.toDataURL("image/png");
    const link = document.createElement("a");

    link.href = data;
    link.download = `${nom.trim()}-badge.png`;

    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  async function handleDownloadPDF() {
    const badgeElement = document.getElementById("badge");
    const canvas = await html2canvas(badgeElement);
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF();
    // pdf.addImage(imgData, "PNG", 0, 0, , , , , 90);
    pdf.addImage({
      imageData: imgData,
      format: "PNG",
      x: 0,
      y: 0,
    });
    pdf.save(`${nom.trim()}-badge.pdf`);
  }
  return (
    <div>
      <div
        id="badge"
        className="shdw  relative h-[563px] w-[994px] space-y-10 overflow-hidden rounded-[20px] bg-main-white px-[38px] py-[28px]"
      >
        <img src={logo} />
        <div className="shdw absolute left-0 right-0 z-10 mx-[38px] flex h-[309] items-center justify-between rounded-[10px] border border-main-two bg-main-white p-8">
          <div className="space-y-2 ">
            <AgentInfo label="Nom & Prenom" value={`${nom} ${prenom}`} />
            <AgentInfo label="Code Super Agent" value={code} />
            <AgentInfo label="Telephone" value={telephone} />
          </div>
          <div className=" h-60 w-56 rounded-[10px] border border-main-two">
            {imagePreview ? (
              <img
                src={imagePreview}
                className="h-full w-full  rounded-[10px] object-cover object-top"
              />
            ) : (
              <div className="flex h-full w-full items-center justify-center rounded-[10px]  bg-main-white">
                <span className="loader"></span>
              </div>
            )}
          </div>
        </div>
        <div className="absolute bottom-0 right-0 z-0">
          <svg
            width="994"
            height="535"
            viewBox="0 0 994 535"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect
              x="15"
              y="545.446"
              width="1226.15"
              height="140"
              transform="rotate(-19.1607 15 545.446)"
              fill="#409FD9"
            />
            <rect
              x="230"
              y="646.446"
              width="1226.15"
              height="140"
              transform="rotate(-19.1607 230 646.446)"
              fill="#146698"
            />
            <rect
              x="-76"
              y="402.446"
              width="1226.15"
              height="140"
              transform="rotate(-19.1607 -76 402.446)"
              fill="#1C81C5"
            />
          </svg>
        </div>
      </div>
      <div className="mt-9 flex items-start justify-between">
        <button
          className="flex items-center justify-center gap-4 rounded-[10px] border-2 border-main-one px-6 py-[12px] duration-150"
          onClick={() => setOpen(false)}
        >
          <svg
            width="9"
            height="15"
            viewBox="0 0 9 15"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M7.09521 1.40214L0.999977 7.50002L7.09521 13.5979"
              stroke="#083553"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </svg>
          <span className="text-xl font-semibold text-main-two">Retour</span>
        </button>
        <div className="flex gap-5">
          <span className="text-xl font-semibold text-txt-grey">Download:</span>
          <button onClick={handleImageDownload}>
            <svg
              width="61"
              height="60"
              viewBox="0 0 61 60"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8.68003 60H52.3164C53.8227 60 55.0437 58.7789 55.0437 57.2727V20.9789C55.0061 22.4523 53.8028 23.6358 52.3201 23.6358C52.3187 23.6358 52.3175 23.6358 52.3164 23.6358H49.5891H34.1346C32.6284 23.6358 31.4073 22.4147 31.4073 20.9085V5.45449V2.7273C31.4073 1.62422 32.0716 0.629648 33.0909 0.207656C33.4414 0.0625781 33.8098 -0.00339844 34.1745 0.00222656C34.161 0.001875 34.148 0 34.1346 0H8.68003C7.17382 0 5.95273 1.22109 5.95273 2.7273V57.2728C5.95273 58.7789 7.17382 60 8.68003 60ZM30.3929 29.9693C30.9002 29.4602 31.6037 29.1693 32.3218 29.1693C33.0382 29.1693 33.742 29.4601 34.2493 29.9693C34.7584 30.4766 35.0491 31.1802 35.0491 31.8966C35.0491 32.6147 34.7582 33.3184 34.2493 33.8257C33.742 34.333 33.0402 34.6239 32.3218 34.6239C31.6037 34.6239 30.9002 34.333 30.3929 33.8257C29.8856 33.3184 29.5945 32.6166 29.5945 31.8966C29.5945 31.1782 29.8856 30.4766 30.3929 29.9693ZM16.8618 44.8932C16.8618 44.2042 17.1227 43.5405 17.5921 43.0358L22.4346 37.8296C23.3871 36.8053 24.9602 36.668 26.0762 37.5115L33.138 42.8501L36.6687 40.7075C37.8371 39.9987 39.3493 40.2638 40.2065 41.327L41.7022 43.1814C42.0932 43.6663 42.3065 44.2705 42.3065 44.8936V46.3638C42.3065 47.87 41.0854 49.0911 39.5792 49.0911H19.5891C18.0829 49.0911 16.8618 47.87 16.8618 46.3638V44.8932Z"
                fill="#E0E0E2"
              />
              <path
                d="M32.3218 34.6239C33.0399 34.6239 33.742 34.3331 34.2493 33.8258C34.7583 33.3185 35.0491 32.6149 35.0491 31.8966C35.0491 31.1802 34.7582 30.4767 34.2493 29.9694C33.742 29.4603 33.0384 29.1693 32.3218 29.1693C31.6037 29.1693 30.9002 29.4602 30.3929 29.9694C29.8856 30.4767 29.5945 31.1785 29.5945 31.8966C29.5945 32.6166 29.8856 33.3185 30.3929 33.8258C30.9002 34.3329 31.6037 34.6239 32.3218 34.6239Z"
                fill="#083553"
              />
              <path
                d="M19.5891 49.0909H39.5791C41.0853 49.0909 42.3064 47.8699 42.3064 46.3636V44.8934C42.3064 44.2706 42.0931 43.6661 41.7021 43.1812L40.2064 41.3268C39.3492 40.2633 37.837 39.9985 36.6686 40.7074L33.1379 42.8499L26.0761 37.5113C24.9598 36.6679 23.387 36.8051 22.4345 37.8295L17.592 43.0356C17.1226 43.5401 16.8617 44.2038 16.8617 44.8931V46.3634C16.8618 47.8699 18.0829 49.0909 19.5891 49.0909Z"
                fill="#083553"
              />
              <path
                d="M31.4073 2.72733V5.45463V20.9086C31.4073 22.4148 32.6284 23.6359 34.1346 23.6359H49.5891H52.3164C52.3175 23.6359 52.3187 23.6359 52.3201 23.6359C53.8028 23.6359 55.0061 22.4523 55.0437 20.979C55.0443 20.9554 55.0474 20.9325 55.0474 20.9087C55.0474 20.3434 54.873 19.8202 54.5786 19.3847C54.5783 19.3844 54.578 19.384 54.5777 19.3834C54.5312 19.3145 54.4811 19.2483 54.4287 19.1842C54.4244 19.1789 54.4204 19.1734 54.416 19.1684C54.3663 19.1086 54.3134 19.0511 54.2591 18.9956C54.2505 18.9871 54.2422 18.9784 54.2336 18.9699C54.2096 18.9464 54.1875 18.9208 54.1627 18.898L36.0631 0.798775C36.0065 0.742057 35.947 0.689088 35.8864 0.638229C35.868 0.622994 35.8495 0.60858 35.8307 0.593814C35.7866 0.558775 35.7413 0.524674 35.6949 0.492213C35.6728 0.476744 35.6507 0.461275 35.628 0.446627C35.5795 0.414752 35.5297 0.384986 35.4793 0.356041C35.4598 0.344908 35.441 0.332955 35.4215 0.322643C35.3555 0.287135 35.2877 0.254791 35.2184 0.224791C35.1914 0.212955 35.1634 0.20276 35.1359 0.191861C35.0899 0.173697 35.0434 0.156353 34.9961 0.140768C34.9645 0.130455 34.9332 0.12026 34.9016 0.111002C34.8485 0.0955332 34.7947 0.0819394 34.7403 0.0695176C34.7172 0.0642441 34.6942 0.0576816 34.671 0.0531113C34.5949 0.0378769 34.5174 0.0263926 34.4392 0.0178379C34.4158 0.0151426 34.3924 0.0136191 34.3687 0.0116269C34.3047 0.00611913 34.24 0.0027207 34.1748 0.0017832C33.8101 -0.00372462 33.4416 0.0621347 33.0911 0.207213C32.0718 0.629674 31.4073 1.62424 31.4073 2.72733Z"
                fill="#C6C5CA"
              />
            </svg>
            <span className="text-xl font-semibold text-main-two">Image</span>
          </button>
          <button onClick={handleDownloadPDF}>
            <svg
              width="60"
              height="60"
              viewBox="0 0 60 60"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8.18003 60H51.8164C53.3227 60 54.5437 58.7789 54.5437 57.2727V20.9789C54.5061 22.4523 53.3028 23.6358 51.8201 23.6358C51.8187 23.6358 51.8175 23.6358 51.8164 23.6358H49.0891H33.6346C32.1284 23.6358 30.9073 22.4147 30.9073 20.9085V5.45449V2.7273C30.9073 1.62422 31.5716 0.629648 32.5909 0.207656C32.9414 0.0625781 33.3098 -0.00339844 33.6745 0.00222656C33.661 0.001875 33.648 0 33.6346 0H8.18003C6.67382 0 5.45273 1.22109 5.45273 2.7273V57.2728C5.45273 58.7789 6.67382 60 8.18003 60ZM29.8929 29.9693C30.4002 29.4602 31.1037 29.1693 31.8218 29.1693C32.5382 29.1693 33.242 29.4601 33.7493 29.9693C34.2584 30.4766 34.5491 31.1802 34.5491 31.8966C34.5491 32.6147 34.2582 33.3184 33.7493 33.8257C33.242 34.333 32.5402 34.6239 31.8218 34.6239C31.1037 34.6239 30.4002 34.333 29.8929 33.8257C29.3856 33.3184 29.0945 32.6166 29.0945 31.8966C29.0945 31.1782 29.3856 30.4766 29.8929 29.9693ZM16.3618 44.8932C16.3618 44.2042 16.6227 43.5405 17.0921 43.0358L21.9346 37.8296C22.8871 36.8053 24.4602 36.668 25.5762 37.5115L32.638 42.8501L36.1687 40.7075C37.3371 39.9987 38.8493 40.2638 39.7065 41.327L41.2022 43.1814C41.5932 43.6663 41.8065 44.2705 41.8065 44.8936V46.3638C41.8065 47.87 40.5854 49.0911 39.0792 49.0911H19.0891C17.5829 49.0911 16.3618 47.87 16.3618 46.3638V44.8932Z"
                fill="#E0E0E2"
              />
              <rect
                width="26.3743"
                height="25.4821"
                transform="translate(15.5834 26.1063)"
                fill="#E0E0E2"
              />
              <path
                d="M37.7515 40.5708C36.7673 40.5116 34.4012 40.6518 32.0316 41.102C30.6608 39.7146 29.4738 37.9669 28.5933 36.5255C31.4149 28.4123 29.6279 26.1063 27.2225 26.1063C25.3336 26.1063 24.3905 28.0998 24.6004 30.3022C24.7065 31.4109 25.6454 33.7405 26.8011 35.9534C26.0921 37.818 24.8269 40.9697 23.571 43.2505C22.1009 43.6972 20.8399 44.1936 19.935 44.6125C15.4274 46.7087 15.0652 49.5077 16.0031 50.6938C17.784 52.9468 21.5784 51.0029 25.3859 44.1936C27.9925 43.4524 31.422 42.4649 31.7311 42.4649C31.7667 42.4649 31.8156 42.4762 31.8722 42.4945C33.7724 44.1701 36.0166 46.0887 37.8638 46.3412C40.5366 46.7087 42.058 44.7702 41.9525 43.5648C41.848 42.3587 41.1435 40.7744 37.7515 40.5708ZM20.8782 47.9156C19.7766 49.2255 17.9947 50.482 17.3659 50.0641C16.7363 49.6453 16.6317 48.4399 18.0478 47.0762C19.463 45.7141 21.8318 45.007 22.1879 44.8746C22.6086 44.7179 22.7132 44.8746 22.7132 45.0845C22.7132 45.2944 21.979 46.6042 20.8782 47.9156ZM25.7019 30.3013C25.5966 28.9897 25.8578 27.7323 26.9595 27.5755C28.0594 27.4171 28.5846 28.6754 28.1655 30.7194C27.7458 32.766 27.5351 34.1272 27.326 34.2866C27.1163 34.4434 26.908 33.9182 26.908 33.9182C26.4875 33.0785 25.8064 31.6111 25.7019 30.3013ZM26.1217 42.6207C26.6973 41.6757 28.1657 37.851 28.1657 37.851C28.4801 38.4282 30.9429 41.3614 30.9429 41.3614C30.9429 41.3614 27.1685 42.2019 26.1217 42.6207ZM37.5468 44.2963C35.9748 44.0891 33.3021 42.1992 33.3021 42.1992C32.9355 42.0425 36.2309 41.5949 37.4962 41.6759C39.1222 41.7813 39.6987 42.4631 39.6987 43.1442C39.6987 43.826 39.1222 44.5063 37.5468 44.2963Z"
                fill="#083553"
              />
              <path
                d="M30.9073 2.72733V5.45463V20.9086C30.9073 22.4148 32.1284 23.6359 33.6346 23.6359H49.0891H51.8164C51.8175 23.6359 51.8187 23.6359 51.8201 23.6359C53.3028 23.6359 54.5061 22.4523 54.5437 20.979C54.5443 20.9554 54.5474 20.9325 54.5474 20.9087C54.5474 20.3434 54.373 19.8202 54.0786 19.3847C54.0783 19.3844 54.078 19.384 54.0777 19.3834C54.0312 19.3145 53.9811 19.2483 53.9287 19.1842C53.9244 19.1789 53.9204 19.1734 53.916 19.1684C53.8663 19.1086 53.8134 19.0511 53.7591 18.9956C53.7505 18.9871 53.7422 18.9784 53.7336 18.9699C53.7096 18.9464 53.6875 18.9208 53.6627 18.898L35.5631 0.798775C35.5065 0.742057 35.447 0.689088 35.3864 0.638229C35.368 0.622994 35.3495 0.60858 35.3307 0.593814C35.2866 0.558775 35.2413 0.524674 35.1949 0.492213C35.1728 0.476744 35.1507 0.461275 35.128 0.446627C35.0795 0.414752 35.0297 0.384986 34.9793 0.356041C34.9598 0.344908 34.941 0.332955 34.9215 0.322643C34.8555 0.287135 34.7877 0.254791 34.7184 0.224791C34.6914 0.212955 34.6634 0.20276 34.6359 0.191861C34.5899 0.173697 34.5434 0.156353 34.4961 0.140768C34.4645 0.130455 34.4332 0.12026 34.4016 0.111002C34.3485 0.0955332 34.2947 0.0819394 34.2403 0.0695176C34.2172 0.0642441 34.1942 0.0576816 34.171 0.0531113C34.0949 0.0378769 34.0174 0.0263926 33.9392 0.0178379C33.9158 0.0151426 33.8924 0.0136191 33.8687 0.0116269C33.8047 0.00611913 33.74 0.0027207 33.6748 0.0017832C33.3101 -0.00372462 32.9416 0.0621347 32.5911 0.207213C31.5718 0.629674 30.9073 1.62424 30.9073 2.72733Z"
                fill="#C6C5CA"
              />
            </svg>
            <span className="text-xl  font-semibold text-main-two">Pdf</span>
          </button>
        </div>
      </div>
    </div>
  );
}

Badge.propTypes = {
  data: {
    nom: PropTypes.string,
    prenom: PropTypes.string,
    telephone: PropTypes.string,
    code: PropTypes.string,
  },
  image: PropTypes.object,
  setOpen: PropTypes.func,
};

export default Badge;
